<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aviator — Hot Streaks & Polished Roulette</title>
  <style>
    :root{
      --bg-1:#050910; --bg-2:#08171c; --accent:#00d4ff; --accent-2:#7afcff; --muted:#98a6b3;
      --good:#22c55e; --bad:#ff5252; --glass:rgba(255,255,255,0.03); --shadow:0 18px 60px rgba(0,0,0,0.65)
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1),#020408);color:#e6eef6;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    .wrap{min-height:100vh;display:flex;flex-direction:column}
    .top{height:72px;display:flex;align-items:center;justify-content:space-between;padding:0 24px;border-bottom:1px solid rgba(255,255,255,0.02)}
    .brand{font-weight:900}
    .controls{display:flex;gap:12px;align-items:center}
    .balance{font-weight:900}

    .main{display:grid;grid-template-columns:1fr 420px;gap:20px;padding:20px;flex:1}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:14px;padding:14px;box-shadow:var(--shadow);border:1px solid var(--glass)}

    .aviator{display:flex;flex-direction:column;height:100%}
    .aviHeader{display:flex;justify-content:space-between;align-items:center}
    .bigMul{font-size:56px;font-weight:900;color:var(--accent);letter-spacing:0.02em}
    .meta{color:var(--muted);font-size:13px}
    .canvasWrap{height:64vh;border-radius:12px;overflow:hidden;margin-top:12px;background:radial-gradient(circle at 10% 10%, rgba(10,30,40,0.25), transparent), linear-gradient(180deg,var(--bg-2), #031219)}
    canvas{width:100%;height:100%;display:block}
    .bottomBar{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .recent{display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;font-weight:800;color:#041018}

    .right{display:flex;flex-direction:column;gap:14px}
    .inputRow{display:flex;gap:8px;align-items:center}
    input[type=number], input[type=text]{padding:10px;border-radius:10px;border:1px solid var(--glass);background:transparent;color:inherit}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--glass);background:transparent;color:inherit;cursor:pointer;font-weight:800}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#02121a}
    .list{max-height:36vh;overflow:auto;margin-top:8px}
    .row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.008), transparent);border:1px solid rgba(255,255,255,0.01)}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{width:980px;max-width:calc(100% - 40px);display:flex;gap:16px;align-items:flex-start}
    .wheelBox{width:420px;height:420px;border-radius:50%;background:linear-gradient(180deg,#07161a,#041017);display:flex;align-items:center;justify-content:center;position:relative;box-shadow:0 18px 60px rgba(0,0,0,0.7)}
    .wheelCanvas{width:92%;height:92%;border-radius:50%}
    .pointer{position:absolute;top:14px;left:50%;transform:translateX(-50%);width:14px;height:36px;border-radius:6px;background:linear-gradient(180deg,#fff,#dfe9ea);box-shadow:0 6px 18px rgba(0,0,0,0.6)}

    .toast{position:fixed;right:22px;bottom:22px;background:linear-gradient(90deg,#05282f,#01333a);padding:12px 16px;border-radius:12px;color:#eafffb;font-weight:800;box-shadow:0 8px 30px rgba(3,8,14,0.6);display:none}

    @media (max-width:1100px){ .main{grid-template-columns:1fr} .wheelBox{width:320px;height:320px} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">Aviator — Hot Streaks</div>
      <div class="controls"><div class="muted">Баланс</div><div id="balance" class="balance">₴1000.00</div><button class="btn" id="openRoulette">Roulette</button><button class="btn primary" id="addFunds">+₴1000</button></div>
    </div>

    <div class="main">
      <div class="aviator card">
        <div class="aviHeader">
          <div>
            <div id="bigMul" class="bigMul">x1.00</div>
            <div class="meta">Status: <span id="status">idle</span> — <span id="countdown">Next in 10s</span></div>
          </div>
          <div style="text-align:right">
            <div class="muted">Onboard</div>
            <div id="onboard" style="font-weight:900">₴0.00</div>
            <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end"><button class="btn" id="startNow">Start now</button><button class="btn primary" id="cashoutAll">Cashout All</button></div>
          </div>
        </div>

        <div class="canvasWrap" style="margin-top:12px;position:relative">
          <canvas id="bgStars" style="position:absolute;inset:0;z-index:0"></canvas>
          <canvas id="aviCanvas" style="position:relative;z-index:1"></canvas>
          <canvas id="confetti" style="position:absolute;inset:0;pointer-events:none;z-index:2"></canvas>
        </div>

        <div class="bottomBar">
          <div><div class="muted">Recent multipliers</div><div id="recent" class="recent"></div></div>
          <div style="text-align:right"><div class="muted">Potential now</div><div id="potential" style="font-weight:900">₴0.00</div></div>
        </div>
      </div>

      <div class="right">
        <div class="card">
          <div class="muted">Add bet — optional auto x (e.g. 2.5)</div>
          <div class="inputRow" style="margin-top:10px"><input id="betAmt" type="number" value="50" min="1" style="width:120px"><input id="autoX" type="text" placeholder="auto x (2.5)" style="width:140px"><button class="btn primary" id="addToQueue">Add</button></div>
          <div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="placeNow">Place now</button><button class="btn" id="refundQueue">Refund</button></div>
        </div>

        <div class="card"><div class="muted">Queue (double-click to edit)</div><div id="queue" class="list"></div></div>
        <div class="card"><div class="muted">Locked / Onboard</div><div id="locked" class="list"></div></div>
        <div class="card"><div class="muted">History</div><div id="history" class="list"></div></div>
      </div>
    </div>

    <div class="overlay" id="overlay"><div class="modal"><div class="wheelBox card"><div class="pointer"></div><canvas id="wheelCanvas" class="wheelCanvas"></canvas></div><div style="flex:1;display:flex;flex-direction:column;gap:8px"><div class="card"><div class="muted">Bet type</div><select id="rType"><option value="color">Color</option><option value="number">Number</option></select><div id="choiceColor" style="margin-top:8px"><button class="btn" id="rRed" style="background:#cc3333;color:#fff">Red</button><button class="btn" id="rBlack" style="background:#111;color:#fff;margin-left:6px">Black</button></div><div id="choiceNumber" style="display:none;margin-top:8px"><input id="rNumber" type="number" min="0" max="36" value="7"></div><div style="margin-top:8px"><label class="muted">Amount</label><input id="rAmt" type="number" value="50" min="1"></div><div style="display:flex;gap:8px;margin-top:8px"><button class="btn primary" id="rAdd">Add</button><button class="btn" id="rSpin">Spin</button><button class="btn" id="rClose">Close</button></div></div><div class="card"><div class="muted">Pending</div><div id="rPending" class="list"></div></div><div class="card"><div class="muted">Result</div><div id="rResult" class="muted"></div></div></div></div></div>

    <div class="toast" id="toast"></div>
  </div>

<script>
// Utilities
const $ = id => document.getElementById(id);
function money(v){return '₴'+(Number(v)||0).toFixed(2);} let balance = 1000; function setBalance(v){ balance = Number(v); $('balance').textContent = money(balance);} setBalance(balance);
function pushHistory(desc, change, game='System'){ const list = $('history'); const el = document.createElement('div'); el.className='row'; el.innerHTML = `<div style="flex:1"><strong>${game}</strong><div class="muted">${desc}</div></div><div>${change>0?'+':''}${money(change)}</div>`; list.prepend(el); }
function toast(msg, time=1600){ const t=$('toast'); t.textContent=msg; t.style.display='block'; t.style.opacity='1'; clearTimeout(t._to); t._to=setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.style.display='none',300); }, time); }

// Audio
const AudioCtx = window.AudioContext || window.webkitAudioContext; const audioCtx = new AudioCtx();
function playTone(freq,dur=0.12,type='sine',vol=0.06){ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type;o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+dur); o.stop(audioCtx.currentTime+dur+0.02);} 
function sStart(){ playTone(520,0.08,'sine',0.05); playTone(760,0.12,'sine',0.05);} function sCrash(){ playTone(120,0.18,'sawtooth',0.12); playTone(80,0.28,'sine',0.08);} function sCash(){ playTone(1200,0.06,'triangle',0.06); playTone(1600,0.08,'triangle',0.05);} function sSpin(){ playTone(340,0.04,'sine',0.04);} function sWin(){ playTone(1400,0.12,'sine',0.08); playTone(1800,0.16,'sine',0.06); }

// Confetti (simple canvas)
const confettiCanvas = $('confetti'); const confCtx = confettiCanvas.getContext('2d'); function resizeConf(){ const r=confettiCanvas.getBoundingClientRect(); confettiCanvas.width = Math.floor(r.width * window.devicePixelRatio); confettiCanvas.height = Math.floor(r.height * window.devicePixelRatio); confCtx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);} window.addEventListener('resize', ()=>{ resizeConf(); }); resizeConf(); let confettiParticles=[]; function spawnConfetti(count=80){ confettiParticles=[]; const w=confettiCanvas.width/window.devicePixelRatio, h=confettiCanvas.height/window.devicePixelRatio; for(let i=0;i<count;i++){ confettiParticles.push({x:Math.random()*w, y: -Math.random()*h*0.5, vx:(Math.random()-0.5)*6, vy:2+Math.random()*6, size:4+Math.random()*6, color: ['#FFDD6E','#FF6B6B','#6EF2FF','#9EF5C4'][Math.floor(Math.random()*4)], rot:Math.random()*360, dr:Math.random()*12}); } let t0=performance.now(); function loop(now){ const dt=(now-t0)/1000; t0=now; confCtx.clearRect(0,0,w,h); for(let p of confettiParticles){ p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.rot += p.dr; confCtx.save(); confCtx.translate(p.x,p.y); confCtx.rotate(p.rot * Math.PI/180); confCtx.fillStyle=p.color; confCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size); confCtx.restore(); } confettiParticles = confettiParticles.filter(p=>p.y < h+50); if(confettiParticles.length>0) requestAnimationFrame(loop); else confCtx.clearRect(0,0,w,h); } requestAnimationFrame(loop); }

// Stars background
const starsCanvas = $('bgStars'); const starsCtx = starsCanvas.getContext('2d'); function resizeStars(){ const r = starsCanvas.getBoundingClientRect(); starsCanvas.width=Math.floor(r.width*window.devicePixelRatio); starsCanvas.height=Math.floor(r.height*window.devicePixelRatio); starsCtx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);} window.addEventListener('resize', ()=>{ resizeStars(); initStars(); }); resizeStars(); let stars=[]; function initStars(){ const w=starsCanvas.width/window.devicePixelRatio, h=starsCanvas.height/window.devicePixelRatio; stars=[]; for(let i=0;i<120;i++){ stars.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.4,alpha:0.2+Math.random()*0.8,dx:(Math.random()-0.5)*0.03}); } drawStars(); } function drawStars(){ const w=starsCanvas.width/window.devicePixelRatio,h=starsCanvas.height/window.devicePixelRatio; starsCtx.clearRect(0,0,w,h); for(let s of stars){ starsCtx.globalAlpha = s.alpha; starsCtx.beginPath(); starsCtx.arc(s.x,s.y,s.r,0,Math.PI*2); starsCtx.fillStyle = '#9fe6ff'; starsCtx.fill(); } starsCtx.globalAlpha=1;} initStars(); setInterval(()=>{ for(let s of stars){ s.alpha = 0.2 + Math.random()*0.9 } drawStars(); },800);

// Aviator core
const avi = { running:false, t:0, last:null, points:[{t:0,m:1}], target:null, round:0, pending:[], locked:[], recent:[], countdown:10, timer:null };
const canvas = $('aviCanvas'); const ctx = canvas.getContext('2d'); function resizeAvi(){ const r = canvas.getBoundingClientRect(); canvas.width = Math.floor(r.width*window.devicePixelRatio); canvas.height = Math.floor(r.height*window.devicePixelRatio); ctx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);} window.addEventListener('resize', resizeAvi); resizeAvi();

// Make crashes often big: mixture model -> higher chance for >1.5
function sampleCrash(cap=1000){ // 65% chance of 'hot' multiplier log-uniform [1.5, 50], else pareto-like
  if(Math.random() < 0.65){ const min=1.5, max=50; const logMin=Math.log(min), logMax=Math.log(max); return Math.exp(logMin + Math.random()*(logMax-logMin)); } else { const alpha=2.5; const u=Math.random(); let s = 1/Math.pow(u,1/alpha); s = Math.min(s, cap*1.6); if(s<1.02) s = 1 + Math.random()*0.02; return s; } }

function growth(t,a0=0.02,a1=0.03){ return Math.exp(a0*t + 0.5*a1*t*t); }

function startCountdown(sec=10){ avi.countdown = sec; $('countdown').textContent = `Next in ${avi.countdown}s`; if(avi.timer) clearInterval(avi.timer); avi.timer = setInterval(()=>{ avi.countdown--; $('countdown').textContent = `Next in ${avi.countdown}s`; if(avi.countdown<=0){ clearInterval(avi.timer); launchRound(); } },1000); }

function launchRound(){ // user gesture resume audio if needed
  if(audioCtx.state === 'suspended') audioCtx.resume(); avi.round++; avi.target = sampleCrash(1000); avi.running = true; avi.t = 0; avi.last = null; avi.points = [{t:0,m:1}]; const total = avi.pending.reduce((s,b)=>s+b.amount,0); avi.locked = avi.locked.concat(avi.pending.map(b=>Object.assign({},b))); avi.pending = []; if(total>0){ setBalance(balance - total); pushHistory(`Round ${avi.round}: placed ${money(total)}`, -total, 'Aviator'); toast('Round started — good luck!'); sStart(); } $('status').textContent = 'running'; renderLists(); }

function endRound(crash){ const lost = avi.locked.reduce((s,b)=>s+b.amount,0); if(lost>0) pushHistory(`Round ${avi.round}: crash @ x${crash.toFixed(2)} - lost ${money(lost)}`, -lost, 'Aviator'); avi.recent.unshift(crash); if(avi.recent.length>30) avi.recent.pop(); avi.locked = []; renderLists(); renderRecent(); avi.running = false; $('status').textContent = 'crash'; startCountdown(10); sCrash(); toast(`Crash @ x${crash.toFixed(2)}`); // big crash: spawn confetti to celebrate big multipliers that happened
  if(crash >= 5) { spawnConfetti(120); sWin(); }
}

function cashout(index){ if(!avi.running) return; if(index<0||index>=avi.locked.length) return; const b = avi.locked[index]; const cur = avi.points[avi.points.length-1].m || 1; const payout = b.amount * cur; setBalance(balance + payout); pushHistory(`Cashout ${money(b.amount)} @ x${cur.toFixed(2)} -> ${money(payout)}`, payout - b.amount, 'Aviator'); avi.locked.splice(index,1); renderLists(); sCash(); toast(`Cashout ${money(payout)}`); if(payout >= 2000) { spawnConfetti(100); sWin(); } }

function cashoutAll(){ if(!avi.running) return; const cur = avi.points[avi.points.length-1].m || 1; let total=0; while(avi.locked.length){ const b = avi.locked.shift(); const p = b.amount * cur; total += p; pushHistory(`Cashout ${money(b.amount)} @ x${cur.toFixed(2)} -> ${money(p)}`, p - b.amount, 'Aviator'); } if(total>0) setBalance(balance + total); renderLists(); sCash(); toast(`Cashout all ${money(total)}`); if(total >= 2000) { spawnConfetti(140); sWin(); } }

function refundQueue(){ const total = avi.pending.reduce((s,b)=>s+b.amount,0); if(total>0){ setBalance(balance + total); pushHistory(`Refunded queue ${money(total)}`, total, 'Aviator'); avi.pending=[]; renderLists(); toast(`Refunded ${money(total)}`); } }
function placeNow(){ const total = avi.pending.reduce((s,b)=>s+b.amount,0); if(total<=0) return; if(total>balance){ alert('Insufficient'); return; } setBalance(balance - total); avi.locked = avi.locked.concat(avi.pending.map(b=>Object.assign({},b))); avi.pending = []; pushHistory(`Placed now ${money(total)}`, -total, 'Aviator'); renderLists(); toast(`Placed ${money(total)}`); }

function renderLists(){ const q=$('queue'); q.innerHTML=''; if(avi.pending.length===0) q.textContent='(empty)'; else avi.pending.forEach((b,i)=>{ const row=document.createElement('div'); row.className='row'; row.ondblclick=()=>editPending(i); row.innerHTML = `<div style="flex:1">${i+1}. ${money(b.amount)} ${b.autoTarget? ' — auto x'+b.autoTarget : ''}</div><div style='display:flex;gap:6px'><button class='btn' onclick='editPending(${i})'>Edit</button><button class='btn' onclick='removePending(${i})'>Remove</button></div>`; q.appendChild(row); }); const l=$('locked'); l.innerHTML=''; if(avi.locked.length===0) l.textContent='(empty)'; else avi.locked.forEach((b,i)=>{ const cur=avi.points[avi.points.length-1]?.m||1; const pot=b.amount * cur; const row=document.createElement('div'); row.className='row'; row.innerHTML=`<div style="flex:1">#${i+1} ${money(b.amount)} ${b.autoTarget? ' — auto x'+b.autoTarget : ''} — pot ${money(pot)}</div><div style='display:flex;gap:6px'><button class='btn' onclick='cashout(${i})'>Cashout</button></div>`; l.appendChild(row); }); $('onboard').textContent = money(avi.pending.reduce((s,b)=>s+b.amount,0) + avi.locked.reduce((s,b)=>s+b.amount,0)); $('potential').textContent = money(avi.locked.reduce((s,b)=>s + b.amount * (avi.points[avi.points.length-1]?.m||1),0)); }
window.removePending = function(i){ if(i<0||i>=avi.pending.length) return; avi.pending.splice(i,1); renderLists(); }
window.editPending = function(i){ const b = avi.pending[i]; const a = prompt('Edit amount', b.amount); if(a!==null){ const v = Number(a); if(!isNaN(v) && v>0) b.amount = v; } const at = prompt('Auto-cash x (empty = off)', b.autoTarget||''); if(at!==null){ const t = parseFloat(at); b.autoTarget = isNaN(t)? null : t; } renderLists(); }

// Drawing Aviator: trail glow and plane
function drawGrid(){ const w=canvas.width/window.devicePixelRatio, h=canvas.height/window.devicePixelRatio; ctx.clearRect(0,0,w,h); ctx.save(); ctx.strokeStyle='rgba(255,255,255,0.03)'; ctx.lineWidth=1; ctx.font='12px Inter, sans-serif'; ctx.fillStyle='rgba(255,255,255,0.06)'; const ticks=[1,2,5,10,20,50,100,200,500,1000]; ticks.forEach(v=>{ const y=mapY(v); ctx.beginPath(); ctx.moveTo(60,y); ctx.lineTo(w-20,y); ctx.stroke(); ctx.fillText('x'+v,14,y+4); }); ctx.restore(); }
function mapY(m,cap=1000){ const h = canvas.height/window.devicePixelRatio, margin=46; const logMax = Math.log10(cap); const lm = Math.log10(Math.max(1,m)); const frac = (lm - 0) / Math.max(1e-6,(logMax-0)); return h - margin - frac*(h - margin*2); }
function mapX(i){ const w = canvas.width/window.devicePixelRatio, margin=60, maxPoints=Math.max(200, avi.points.length); const frac = i/(maxPoints-1||1); return margin + frac*(w - margin*2); }
function drawPlane(x,y){ ctx.save(); const len=avi.points.length; const prev=avi.points[Math.max(0,len-2)]; const px=mapX(Math.max(0,len-2)), py=mapY(prev.m); const angle=Math.atan2(y-py,x-px); ctx.translate(x,y); ctx.rotate(angle); ctx.beginPath(); ctx.moveTo(-18,9); ctx.lineTo(18,0); ctx.lineTo(-18,-9); ctx.closePath(); ctx.fillStyle='rgba(0,212,255,0.98)'; ctx.shadowColor='rgba(0,212,255,0.18)'; ctx.shadowBlur=18; ctx.fill(); ctx.restore(); }
function drawAvi(){ drawGrid(); ctx.save(); ctx.lineWidth=3; const grad=ctx.createLinearGradient(0,0,canvas.width/window.devicePixelRatio,0); grad.addColorStop(0,'#00d4ff'); grad.addColorStop(1,'#7afcff'); ctx.strokeStyle = grad; ctx.beginPath(); avi.points.forEach((p,i)=>{ const x=mapX(i), y=mapY(p.m); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke(); // glow
  ctx.globalAlpha=0.18; ctx.lineWidth=22; ctx.stroke(); ctx.globalAlpha=1; ctx.lineWidth=3; // plane
  const cur=avi.points[avi.points.length-1]; const cx=mapX(avi.points.length-1), cy=mapY(cur.m); // trail dots
  for(let i=Math.max(0, avi.points.length-60); i<avi.points.length; i+=3){ const p=avi.points[i]; const tx=mapX(i), ty=mapY(p.m); const a = (i/avi.points.length); ctx.beginPath(); ctx.fillStyle = `rgba(0,212,255,${0.08 + a*0.3})`; ctx.arc(tx,ty,1.8,0,Math.PI*2); ctx.fill(); }
  drawPlane(cx,cy); ctx.beginPath(); ctx.fillStyle='#fff'; ctx.arc(cx,cy,5,0,Math.PI*2); ctx.fill(); ctx.restore(); }

function aviLoop(now){ if(!avi.last) avi.last = now; const dt=(now-avi.last)/1000; avi.last = now; if(avi.running){ avi.t += dt; const m = growth(avi.t,0.02,0.03); avi.points.push({t:avi.t,m:Math.min(m,1000*1.6)}); if(avi.points.length>4000) avi.points.shift(); $('bigMul').textContent = 'x'+Number(Math.min(m,1000)).toFixed(2);
    // auto cashout
    for(let i=avi.locked.length-1;i>=0;i--){ const b = avi.locked[i]; if(b.autoTarget && !isNaN(b.autoTarget) && m >= b.autoTarget){ const payout = b.amount * m; setBalance(balance + payout); pushHistory(`AutoCashout ${money(b.amount)} @ x${m.toFixed(2)} -> ${money(payout)}`, payout - b.amount, 'Aviator'); avi.locked.splice(i,1); sCash(); toast(`AutoCashout ${money(payout)}`); if(payout>=1500) { spawnConfetti(80); sWin(); } } }
    if(m >= avi.target){ $('bigMul').textContent = 'x'+avi.target.toFixed(2); endRound(avi.target); avi.running = false; }
  }
  drawAvi(); renderLists(); requestAnimationFrame(aviLoop); }
requestAnimationFrame(aviLoop);
startCountdown(10);
function renderRecent(){ const box=$('recent'); box.innerHTML=''; avi.recent.forEach(x=>{ const n=Number(x).toFixed(2); const d=document.createElement('div'); d.className='pill'; d.textContent = n; if(Number(x)>=1.5) d.style.background='linear-gradient(90deg,var(--good),var(--accent-2))'; else d.style.background='linear-gradient(90deg,var(--bad),#ff9a9a)'; box.appendChild(d); }); }

// UI bindings
$('addToQueue').addEventListener('click', ()=>{ const amt=Number($('betAmt').value)||0; const at=parseFloat($('autoX').value)||null; if(amt<=0){ alert('Enter amount'); return; } if(amt>balance){ alert('Insufficient funds'); return; } const e={amount:amt,autoTarget:isNaN(at)?null:at}; avi.pending.push(e); renderLists(); toast(`Queued ${money(amt)}${e.autoTarget? ' auto x'+e.autoTarget:''}`); });
$('placeNow').addEventListener('click', ()=>{ placeNow(); });
$('refundQueue').addEventListener('click', ()=>{ refundQueue(); });
$('startNow').addEventListener('click', ()=>{ if(avi.running) return; if(avi.timer) clearInterval(avi.timer); launchRound(); });
$('cashoutAll').addEventListener('click', ()=>{ cashoutAll(); });
$('addFunds').addEventListener('click', ()=>{ setBalance(balance+1000); pushHistory('Added +₴1000',1000,'System'); toast('Added ₴1000'); });

// Ensure canvases resize
function resizeAll(){ resizeAvi(); resizeConf(); resizeStars(); drawStars(); } window.addEventListener('resize', resizeAll);

/* ------------------ Roulette (stable) ------------------ */
const wheelCanvas = $('wheelCanvas'); const wctx = wheelCanvas.getContext('2d'); function wheelResize(){ const r = wheelCanvas.getBoundingClientRect(); wheelCanvas.width = Math.floor(r.width*window.devicePixelRatio); wheelCanvas.height = Math.floor(r.height*window.devicePixelRatio); wctx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);} window.addEventListener('resize', wheelResize); wheelResize();
const nums=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26]; const redSet=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]); const cols={}; nums.forEach(n=>cols[n]=n===0?'green': redSet.has(n)?'red':'black'); let rPending=[]; let wheelAngle=0; let spinning=false;
function drawWheel(angle=0){ wheelAngle = angle; const w = wheelCanvas.width/window.devicePixelRatio, h = wheelCanvas.height/window.devicePixelRatio, cx=w/2, cy=h/2, r=Math.min(w,h)/2 - 8; wctx.clearRect(0,0,w,h); const seg=(Math.PI*2)/nums.length; for(let i=0;i<nums.length;i++){ const a=i*seg+angle; wctx.beginPath(); wctx.moveTo(cx,cy); wctx.arc(cx,cy,r,a,a+seg); wctx.closePath(); wctx.fillStyle = cols[nums[i]]==='red'?'#cc3333': cols[nums[i]]==='black'?'#0b0b0b':'#2ecc71'; wctx.fill(); wctx.save(); wctx.translate(cx,cy); wctx.rotate(a+seg/2); wctx.fillStyle='#fff'; wctx.font=Math.max(10, r*0.08)+'px sans-serif'; wctx.textAlign='right'; wctx.fillText(nums[i].toString(), r-12, 6); wctx.restore(); } wctx.beginPath(); wctx.arc(cx,cy,r*0.58,0,Math.PI*2); wctx.fillStyle='rgba(0,0,0,0.18)'; wctx.fill(); }
function renderRPending(){ const el=$('rPending'); el.innerHTML=''; if(rPending.length===0) el.textContent='(empty)'; else rPending.forEach((b,i)=>{ const d=document.createElement('div'); d.className='row'; d.innerHTML=`<div>${i+1}. ${b.type==='color'?b.choice:b.number}</div><div>${money(b.amount)}</div>`; el.appendChild(d); }); }
$('openRoulette').addEventListener('click', ()=>{ $('overlay').style.display='flex'; renderRPending(); drawWheel(wheelAngle); });
$('rType').addEventListener('change', ()=>{ const v=$('rType').value; $('choiceColor').style.display = v==='color'?'block':'none'; $('choiceNumber').style.display = v==='number'?'block':'none'; });
$('rRed').addEventListener('click', ()=>{ window._rChoice='red'; $('rRed').style.outline='2px solid rgba(255,255,255,0.06)'; $('rBlack').style.outline='none'; });
$('rBlack').addEventListener('click', ()=>{ window._rChoice='black'; $('rBlack').style.outline='2px solid rgba(255,255,255,0.06)'; $('rRed').style.outline='none'; });
$('rAdd').addEventListener('click', ()=>{ const type=$('rType').value; const amt=Number($('rAmt').value)||0; if(amt<=0){ alert('Enter amount'); return;} if(amt>balance){ alert('Insufficient funds'); return;} if(type==='color'){ const choice=window._rChoice; if(!choice){ alert('Choose color'); return;} rPending.push({type:'color',choice,amount:amt}); setBalance(balance-amt); pushHistory(`Roulette queued ${choice} ${money(amt)}`,-amt,'Roulette'); } else { const num=Number($('rNumber').value); if(Number.isNaN(num)||num<0||num>36){ alert('Number 0-36'); return;} rPending.push({type:'number',number:num,amount:amt}); setBalance(balance-amt); pushHistory(`Roulette queued #${num} ${money(amt)}`,-amt,'Roulette'); } renderRPending(); toast('Bet added'); sSpin(); updateBalanceUI(); });
function spinRoulette(){ if(spinning) return; if(rPending.length===0){ alert('No bets'); return;} spinning=true; $('rSpin').disabled=true; sSpin(); const target = Math.floor(Math.random()*nums.length); const seg=(Math.PI*2)/nums.length; const targetAngle = -(target*seg) + Math.PI/2; const rotations = 6 + Math.floor(Math.random()*3); const final = targetAngle - rotations*(Math.PI*2); const start = performance.now(); const from = wheelAngle; const dur = 3600 + Math.floor(Math.random()*900);
  function anim(now){ const t = Math.min(1,(now-start)/dur); const ease = 1 - Math.pow(1-t,3); const angle = from + (final - from) * ease; drawWheel(angle); if(t<1) requestAnimationFrame(anim); else settleRoulette(target); }
  requestAnimationFrame(anim);
}
function settleRoulette(target){ const number=nums[target]; const color=cols[number]; let win=0; let total=0; rPending.forEach(b=>{ total += b.amount; if(b.type==='color'){ if(b.choice===color) win += b.amount*2; } else { if(b.number===number) win += b.amount*36; } }); if(win>0){ setBalance(balance + win); pushHistory(`Roulette result ${number} ${color} -> win ${money(win)}`, win, 'Roulette'); $('rResult').textContent = `Result ${number} (${color}). You won ${money(win)}!`; toast(`Roulette win ${money(win)}`); sWin(); if(win>=1500) spawnConfetti(100); } else { pushHistory(`Roulette result ${number} ${color} -> lost ${money(total)}`, -total, 'Roulette'); $('rResult').textContent = `Result ${number} (${color}). You lost ${money(total)}.`; toast(`Roulette lost ${money(total)}`); } rPending=[]; renderRPending(); updateBalanceUI(); spinning=false; $('rSpin').disabled=false; }
$('rSpin').addEventListener('click', ()=>{ spinRoulette(); });
$('rClose').addEventListener('click', ()=>{$('overlay').style.display='none';});
$('overlay').addEventListener('click',(e)=>{ if(e.target==$('overlay')) $('overlay').style.display='none'; });

function updateBalanceUI(){ $('balance').textContent = money(balance); }
function updateLoop(){ updateBalanceUI(); requestAnimationFrame(updateLoop); } requestAnimationFrame(updateLoop);

// init
renderRPending(); drawWheel(0);

</script>
</body>
</html>
